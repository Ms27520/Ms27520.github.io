{
    "version": "https://jsonfeed.org/version/1",
    "title": "只是芒果 • All posts by \"笔记\" tag",
    "description": "",
    "home_page_url": "https://blog.11l.nl",
    "items": [
        {
            "id": "https://blog.11l.nl/posts/50aa/",
            "url": "https://blog.11l.nl/posts/50aa/",
            "title": "使用Docker-compose部署JoplinServer",
            "date_published": "2021-09-07T01:25:00.000Z",
            "content_html": "<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"准备：Linux服务器、本地电脑（或手机？）、域名、人\"><a href=\"#准备：Linux服务器、本地电脑（或手机？）、域名、人\" class=\"headerlink\" title=\"准备：Linux服务器、本地电脑（或手机？）、域名、人\"></a>准备：Linux服务器、本地电脑（或手机？）、域名、人</h2><blockquote>\n<p>确保已经备份好所有笔记，本文中使用的是Ubuntu20.04系统的服务器</p>\n</blockquote>\n<hr>\n<h3 id=\"1-更新系统\"><a href=\"#1-更新系统\" class=\"headerlink\" title=\"1. 更新系统\"></a>1. 更新系统</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt</span> upgrade<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"2-安装并启动Docker\"><a href=\"#2-安装并启动Docker\" class=\"headerlink\" title=\"2. 安装并启动Docker\"></a>2. 安装并启动Docker</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sSL</span> https://get.docker.com/ <span class=\"token operator\">|</span> <span class=\"token function\">sh</span>\nsystemctl <span class=\"token builtin class-name\">enable</span> <span class=\"token function\">docker</span> <span class=\"token operator\">&amp;&amp;</span> systemctl start <span class=\"token function\">docker</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"3-安装Docker-compose\"><a href=\"#3-安装Docker-compose\" class=\"headerlink\" title=\"3. 安装Docker-compose\"></a>3. 安装Docker-compose</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">docker-compose</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"4-创建Joplin工作目录并进入\"><a href=\"#4-创建Joplin工作目录并进入\" class=\"headerlink\" title=\"4. 创建Joplin工作目录并进入\"></a>4. 创建Joplin工作目录并进入</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> Joplin <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> Joplin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"5-创建docker-compose-yml文件，并粘贴配置内容\"><a href=\"#5-创建docker-compose-yml文件，并粘贴配置内容\" class=\"headerlink\" title=\"5. 创建docker-compose.yml文件，并粘贴配置内容\"></a>5. 创建<code>docker-compose.yml</code>文件，并粘贴配置内容</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">vim</span> docker-compose.yml  <span class=\"token comment\">#或者使用其他你喜欢的编辑器</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span><span class=\"token number\">13.1</span>\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5432:5432\"</span>\n        <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> APP_PORT=22300\n            <span class=\"token punctuation\">-</span> POSTGRES_PASSWORD=密码\n            <span class=\"token punctuation\">-</span> POSTGRES_USER=joplin\n            <span class=\"token punctuation\">-</span> POSTGRES_DB=joplin\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> joplin/server<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> db\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"22300:22300\"</span>\n        <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> APP_BASE_URL=https<span class=\"token punctuation\">:</span>//你的域名/\n            <span class=\"token punctuation\">-</span> DB_CLIENT=pg\n            <span class=\"token punctuation\">-</span> POSTGRES_PASSWORD=密码\n            <span class=\"token punctuation\">-</span> POSTGRES_DATABASE=joplin\n            <span class=\"token punctuation\">-</span> POSTGRES_USER=joplin\n            <span class=\"token punctuation\">-</span> POSTGRES_PORT=5432\n            <span class=\"token punctuation\">-</span> POSTGRES_HOST=db<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<ul>\n<li>注意把<code>你的域名</code>更换为你要用的域名，后续在Joplin配置中也需要填入此域名，<code>密码</code>也需要改成你喜欢的</li>\n</ul>\n<h3 id=\"6-开始部署\"><a href=\"#6-开始部署\" class=\"headerlink\" title=\"6. 开始部署\"></a>6. 开始部署</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">-d</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<ul>\n<li>-d 表示后台运行</li>\n</ul>\n<h3 id=\"7-域名配置好解析\"><a href=\"#7-域名配置好解析\" class=\"headerlink\" title=\"7. 域名配置好解析\"></a>7. 域名配置好解析</h3><h3 id=\"8-nginx反向代理实现https\"><a href=\"#8-nginx反向代理实现https\" class=\"headerlink\" title=\"8. nginx反向代理实现https\"></a>8. nginx反向代理实现https</h3><p>(1). 安装并启动nginx</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx\nsystemctl <span class=\"token builtin class-name\">enable</span> nginx <span class=\"token operator\">&amp;&amp;</span> systemctl start nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>(2). 编辑nginx配置</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">vim</span> /etc/nginx/conf.d/joplin.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-conf\" data-language=\"conf\"><code class=\"language-conf\">server {\n    server_name  你的域名;\n    listen 80;\n    #return 301 https://$server_name$request_uri;\n    location / {\n        proxy_pass http://127.0.0.1:22300;\n        proxy_set_header  Host                $http_host;\n        proxy_set_header  X-Real-IP           $remote_addr;\n        proxy_set_header  X-Forwarded-Ssl     on;\n        proxy_set_header  X-Forwarded-For     $proxy_add_x_forwarded_for;\n        proxy_set_header  X-Forwarded-Proto   $scheme;\n        proxy_set_header  X-Frame-Options     SAMEORIGIN;\n\n        client_max_body_size        100m;\n        client_body_buffer_size     128k;\n\n        proxy_buffer_size           4k;\n        proxy_buffers               4 32k;\n        proxy_busy_buffers_size     64k;\n        proxy_temp_file_write_size  64k;\n    }\n}<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>(3). 安装 certbot 配置https</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> python-certbot-nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>(4). 使用 certbot</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">certbot<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>(5). 跟着提示走（不详说了，报错说明你nginx配置有问题请<code>nginx -t</code>）</p>\n<p>(6). 然后选<code>redirect</code>（配置自动重定向https）</p>\n<p>(7). 然后<code>nginx -s reload</code></p>\n<h3 id=\"9-使用宝塔配置反向代理实现https（与7二选一）\"><a href=\"#9-使用宝塔配置反向代理实现https（与7二选一）\" class=\"headerlink\" title=\"9. 使用宝塔配置反向代理实现https（与7二选一）\"></a>9. 使用宝塔配置反向代理实现https（与7二选一）</h3><p>(1). 安装宝塔并安装相关环境(nginx)</p>\n<blockquote>\n<p>在”软件商店”安装nginx，或安装宝塔后在弹窗处一键安装</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/sv3GpBt/fc82c376bf7929de67a326ccdff1d7d2.png\" alt=\"fc82c376bf7929de67a326ccdff1d7d2.png\"></p>\n<p>(2). 添加站点</p>\n<blockquote>\n<p>在”网站”中添加站点，填入自己已经配置好DNS解析的域名，PHP版本选择纯静态，其他默认就好</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/b712CNK/81af94ca85680cf9b70a4c4cae44af4f.png\" alt=\"81af94ca85680cf9b70a4c4cae44af4f.png\"></p>\n<p>(3). 设置反向代理</p>\n<blockquote>\n<p>打开新建的站点的”设置”，按步骤配置，填入要反代的地址，若JoplinServer在本机，在”目标URL”可填入<code>http://localhost:22300</code>或<code>http://127.0.0.1:22300</code>，若为其他服务器反代，填入<code>http://服务器IP:22300</code>保存即可。</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/RB7dMYy/0b8cdaf4a62ca0f9f9b9b55826d56d7e.png\" alt=\"0b8cdaf4a62ca0f9f9b9b55826d56d7e.png\"></p>\n<p>(4). 申请SSL证书</p>\n<blockquote>\n<p>在站点设置中选择”SSL”，本文使用”Let’s Encrypt”申请，选择”验证方式”和”域名”即可。</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/DCv7GzG/550e54b49a741cf90278ea749fd9407a.png\" alt=\"550e54b49a741cf90278ea749fd9407a.png\"></p>\n<h3 id=\"10-访问域名\"><a href=\"#10-访问域名\" class=\"headerlink\" title=\"10. 访问域名\"></a>10. 访问域名</h3><ul>\n<li>JoplinServer默认账号<code>admin@localhost</code>，默认密码<code>admin</code></li>\n</ul>\n<p><img src=\"https://i.ibb.co/hMCw5Qr/199245948fa412a00bb40eacb64d4a45.png\" alt=\"199245948fa412a00bb40eacb64d4a45.png\"></p>\n<blockquote>\n<p>更改账户名和密码</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/D7N6QPY/4ccca67f24f1321c79b2259446dc96c6.png\" alt=\"4ccca67f24f1321c79b2259446dc96c6.png\"></p>\n<blockquote>\n<p>还可在<code>Admin</code>中的<code>User</code>添加其他用户</p>\n</blockquote>\n<h3 id=\"11-在Joplin中配置\"><a href=\"#11-在Joplin中配置\" class=\"headerlink\" title=\"11. 在Joplin中配置\"></a>11. 在Joplin中配置</h3><blockquote>\n<p>打开Joplin的选项</p>\n</blockquote>\n<p><img src=\"https://i.ibb.co/8XcGKwD/e7e504f0670e1d8be998d8f228b69be0.png\" alt=\"e7e504f0670e1d8be998d8f228b69be0.png\"></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://github.com/laurent22/joplin/blob/dev/packages/server/README.md\">官方部署文档</a></p>\n<p><a href=\"https://www.cx03.space/2021/02/12/docker-%E9%83%A8%E7%BD%B2-joplin-server/\">复读机的记事本</a></p>\n<p>note</p>\n<p><a href=\"https://www.bilibili.com/video/BV1Yb411c7Hi\">bilibili</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=fzN5LndPu3M\">youtube</a></p>\n",
            "tags": [
                "Joplin",
                "JoplinServer",
                "笔记"
            ]
        }
    ]
}